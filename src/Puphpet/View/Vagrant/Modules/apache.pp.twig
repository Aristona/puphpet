class { 'apache':
  servername => 'localhost',
  mpm_module => 'prefork'
}

class { 'apache::mod::php': }

{% for module in apache.modules %}
apache::mod { '{{ module }}': }
{% endfor %}

{% for host in apache.vhosts %}
apache::vhost { '{{ host.servername }}':
  servername    => '{{ host.servername }}',
  serveraliases => [
{% if host.serveraliases %}{{ format.explode_and_quote(host.serveraliases)|raw }}
  {% endif %}],
  docroot       => '{{ host.docroot }}',
  port          => '{{ host.port }}',
  setenv        => [
{% if host.envvars %}{{ format.explode_and_quote(host.envvars)|raw }}
  {% endif %}],
  priority      => '1',
  override      => ['All'],
}
{% endfor %}
